<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Relatório Fotográfico RSS - Campo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        /* LANDING PAGE */
        .landing {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            color: white;
        }
        
        .landing-logo {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .landing h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .landing p {
            font-size: 16px;
            opacity: 0.95;
            margin-bottom: 30px;
            max-width: 400px;
        }
        
        .landing-info {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .landing-info h3 {
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .landing-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 14px;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-start {
            background: white;
            color: var(--primary);
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        
        .btn-start:active {
            transform: scale(0.95);
        }
        
        /* MAIN APP */
        .app {
            display: none;
            padding: 20px 10px;
        }
        
        .app.active {
            display: block;
        }
        
        /* HEADER */
        .header {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 20px;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 13px;
            color: #64748b;
        }
        
        /* PROGRESS CARD */
        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 15px;
            color: white;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .progress-bar-container {
            background: #e2e8f0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-bar-fill {
            background: linear-gradient(90deg, var(--success) 0%, #34d399 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 13px;
        }
        
        /* SECTIONS */
        .section {
            background: white;
            border-radius: 20px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .section-header {
            padding: 18px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .section-header:active {
            transform: scale(0.98);
        }
        
        .section-header.critical {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }
        
        .section-header.important {
            background: linear-gradient(135deg, var(--warning) 0%, #ea580c 100%);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .badge {
            background: rgba(255,255,255,0.25);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .arrow {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .arrow.open {
            transform: rotate(180deg);
        }
        
        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .section-content.show {
            max-height: 10000px;
            transition: max-height 0.5s ease-in;
        }
        
        /* ITEMS */
        .item {
            padding: 0;
            border-bottom: 1px solid var(--border);
        }
        
        .item:last-child {
            border-bottom: none;
        }
        
        .item.checked .item-header {
            background: #f0fdf4;
        }
        
        .item-header {
            padding: 15px 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .item-header:active {
            background: #f8fafc;
        }
        
        .checkbox-custom {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border: 2.5px solid #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: white;
        }
        
        .checkbox-custom.checked {
            background: var(--success);
            border-color: var(--success);
        }
        
        .checkbox-custom.checked::after {
            content: '✓';
            color: white;
            font-size: 18px;
            font-weight: bold;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .item-desc {
            font-size: 12px;
            color: #64748b;
            line-height: 1.5;
        }
        
        .star {
            color: var(--warning);
            font-size: 16px;
        }
        
        .expand-btn {
            padding: 5px 10px;
            background: var(--light);
            border: none;
            border-radius: 8px;
            font-size: 12px;
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
        }
        
        /* ITEM DETAILS (EXPANDIDO) */
        .item-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fafbfc;
        }
        
        .item-details.show {
            max-height: 2000px;
            transition: max-height 0.5s ease-in;
        }
        
        .item-details-content {
            padding: 20px;
        }
        
        .detail-section {
            margin-bottom: 20px;
        }
        
        .detail-section:last-child {
            margin-bottom: 0;
        }
        
        .detail-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-text {
            font-size: 13px;
            color: #475569;
            line-height: 1.6;
            background: white;
            padding: 12px;
            border-radius: 10px;
            border-left: 3px solid var(--primary);
        }
        
        .alert-box {
            padding: 12px;
            border-radius: 10px;
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .alert-warning {
            background: #fef3c7;
            border-left: 3px solid var(--warning);
            color: #92400e;
        }
        
        .alert-danger {
            background: #fee2e2;
            border-left: 3px solid var(--danger);
            color: #991b1b;
        }
        
        /* PHOTO UPLOAD */
        .photo-section {
            margin-bottom: 20px;
        }
        
        .photo-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .photo-upload-area:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }
        
        .photo-upload-area.dragover {
            border-color: var(--primary);
            background: #eff6ff;
        }
        
        .upload-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-size: 14px;
            color: var(--dark);
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .upload-hint {
            font-size: 11px;
            color: #64748b;
        }
        
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-preview {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 4/3;
            background: #f1f5f9;
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
        }
        
        .photo-count {
            font-size: 11px;
            color: var(--success);
            font-weight: 600;
            margin-top: 8px;
        }
        
        /* NOTES */
        .notes-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.2s;
        }
        
        .notes-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px;
            display: flex;
            gap: 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            font-family: 'Poppins', sans-serif;
        }
        
        .nav-btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .nav-btn-secondary {
            background: var(--light);
            color: var(--dark);
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
        
        /* FLOATING ACTION BUTTONS */
        .fab-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .fab:active {
            transform: scale(0.9);
        }
        
        .fab-secondary {
            background: white;
            color: var(--primary);
            font-size: 20px;
            width: 48px;
            height: 48px;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-body {
            font-size: 14px;
            color: #475569;
            line-height: 1.6;
        }
        
        .modal-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
        }
        
        .modal-btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .modal-btn-secondary {
            background: var(--light);
            color: var(--dark);
        }
        
        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* RESPONSIVE */
        @media (max-width: 360px) {
            .landing h1 { font-size: 26px; }
            .landing-logo { font-size: 60px; }
            .stats-grid { gap: 10px; }
            .stat-number { font-size: 24px; }
        }
        
        /* HIDE FILE INPUT */
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <!-- LANDING PAGE -->
    <div class="landing" id="landing">
        <div class="landing-logo">📸</div>
        <h1>Relatório Fotográfico RSS</h1>
        <p>Sistema completo de checklist com captura de fotos para inspeção de clínicas e estabelecimentos de saúde</p>
        
        <div class="landing-info">
            <h3>✨ Recursos Premium</h3>
            <div class="landing-features">
                <div class="feature-item">
                    <span>📷</span>
                    <span>Upload de fotos</span>
                </div>
                <div class="feature-item">
                    <span>✓</span>
                    <span>Checklist completo</span>
                </div>
                <div class="feature-item">
                    <span>📊</span>
                    <span>Progresso em tempo real</span>
                </div>
                <div class="feature-item">
                    <span>💾</span>
                    <span>Salva automaticamente</span>
                </div>
                <div class="feature-item">
                    <span>📝</span>
                    <span>Anotações por item</span>
                </div>
                <div class="feature-item">
                    <span>🎯</span>
                    <span>33 itens organizados</span>
                </div>
            </div>
        </div>
        
        <button class="btn-start" onclick="startApp()">🚀 Iniciar Inspeção</button>
        
        <p style="margin-top: 30px; font-size: 12px; opacity: 0.8;">
            Clínica Dr. Cláudio Eulálio<br>
            Sala 1701 - Diamond Center - Teresina/PI
        </p>
    </div>

    <!-- MAIN APP -->
    <div class="app" id="app">
        <!-- HEADER -->
        <div class="header">
            <h1>📸 Relatório Fotográfico RSS</h1>
            <p>Clínica Dr. Cláudio Eulálio - Sala 1701</p>
        </div>
        
        <!-- PROGRESS CARD -->
        <div class="progress-card">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="statDone">0</div>
                    <div class="stat-label">Concluídas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">33</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statCritical">0/13</div>
                    <div class="stat-label">Críticas</div>
                </div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progressBar">0%</div>
            </div>
        </div>

        <!-- SECTIONS -->
        <div id="sectionsContainer"></div>
        
        <div style="height: 20px;"></div>
    </div>

    <!-- FLOATING ACTION BUTTONS -->
    <div class="fab-container" id="fabContainer" style="display: none;">
        <button class="fab fab-secondary" onclick="scrollToTop()" title="Voltar ao topo">↑</button>
        <button class="fab" onclick="openExportModal()" title="Exportar relatório">📤</button>
    </div>

    <!-- BOTTOM NAV -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <button class="nav-btn nav-btn-secondary" onclick="expandAll()">📂 Abrir Tudo</button>
        <button class="nav-btn nav-btn-secondary" onclick="collapseAll()">📁 Fechar</button>
        <button class="nav-btn nav-btn-primary" onclick="openSummary()">📊 Resumo</button>
    </div>

    <!-- MODAL RESUMO -->
    <div class="modal" id="summaryModal">
        <div class="modal-content">
            <div class="modal-header">📊 Resumo da Inspeção</div>
            <div class="modal-body" id="summaryContent"></div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeSummary()">Fechar</button>
                <button class="modal-btn modal-btn-primary" onclick="generateReport()">📄 Gerar Relatório</button>
            </div>
        </div>
    </div>

    <!-- MODAL EXPORTAR -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">📤 Exportar Dados</div>
            <div class="modal-body">
                <p>Escolha como deseja exportar seu progresso:</p>
                <div style="margin-top: 20px;">
                    <button class="modal-btn modal-btn-primary" onclick="downloadJSON()" style="width: 100%; margin-bottom: 10px;">
                        💾 Baixar JSON (Backup Completo)
                    </button>
                    <button class="modal-btn modal-btn-primary" onclick="shareProgress()" style="width: 100%;">
                        📱 Compartilhar Progresso
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeExportModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // DATA STRUCTURE
        const sections = [
            {
                id: 1,
                title: "🏢 FACHADA E ACESSO",
                count: 3,
                type: "normal",
                items: [
                    {
                        id: 1,
                        title: "FOTO 01 - Fachada do Edifício Diamond Center",
                        desc: "Vista externa completa, letreiro visível, contexto urbano",
                        tips: "💡 Tire da calçada oposta (10-15m). Modo horizontal.",
                        critical: false
                    },
                    {
                        id: 2,
                        title: "FOTO 02 - Entrada da Sala 1701",
                        desc: "Porta com número bem visível, acesso ao 17º andar",
                        tips: "💡 2-3 metros de distância. Número deve aparecer claramente.",
                        critical: false
                    },
                    {
                        id: 3,
                        title: "FOTO 03 - Placa de Identificação do Médico",
                        desc: "Placa 'Dr. Cláudio Eulálio - Cirurgia Plástica', legível",
                        tips: "💡 Close (0,5-1m). Evite reflexos no vidro/acrílico.",
                        critical: false
                    }
                ]
            },
            {
                id: 2,
                title: "🛋️ RECEPÇÃO E ESPERA",
                count: 2,
                type: "normal",
                items: [
                    {
                        id: 4,
                        title: "FOTO 04 - Balcão de Recepção",
                        desc: "Vista geral, computador, área de trabalho, organização",
                        tips: "💡 Posicione-se de frente. Foto ampla pegando todo o ambiente.",
                        critical: false
                    },
                    {
                        id: 5,
                        title: "FOTO 05 - Sala de Espera",
                        desc: "Poltronas, TV, ambiente organizado e limpo",
                        tips: "💡 NÃO fotografe pacientes! Agende horário com menos movimento.",
                        alert: "⚠️ ATENÇÃO: Não fotografar pessoas (LGPD)",
                        critical: false
                    }
                ]
            },
            {
                id: 3,
                title: "🩺 CONSULTÓRIO MÉDICO",
                count: 1,
                type: "normal",
                items: [
                    {
                        id: 6,
                        title: "FOTO 06 - Consultório (visão geral)",
                        desc: "Mesa, cadeiras, maca de exame, organização do ambiente",
                        tips: "💡 Tire de um canto (pega mais área). Evite documentos visíveis.",
                        critical: false
                    }
                ]
            },
            {
                id: 4,
                title: "⚕️ SALA DE PROCEDIMENTOS",
                count: 4,
                type: "important",
                items: [
                    {
                        id: 7,
                        title: "FOTO 07 - Sala de Procedimentos (visão geral)",
                        desc: "Vista ampla: maca, foco, armários, bancada, COLETORES visíveis",
                        tips: "💡 Tire diagonal de uma quina. Acenda todas as luzes. Inclua coletores!",
                        critical: false
                    },
                    {
                        id: 8,
                        title: "FOTO 08 - Maca Elétrica e Foco Cirúrgico",
                        desc: "Equipamentos principais, estado de conservação",
                        tips: "💡 Mostre que equipamentos estão em bom estado e funcionais.",
                        critical: false
                    },
                    {
                        id: 9,
                        title: "FOTO 09 - Armários de Materiais",
                        desc: "Armários para materiais estéreis, organização externa",
                        tips: "💡 Pergunte se pode fotografar interior. Se não, só fechado.",
                        critical: false
                    },
                    {
                        id: 10,
                        title: "FOTO 10 - Bancada com Pia",
                        desc: "Pia, torneira (pedal?), sabão, papel toalha, bancada limpa",
                        tips: "💡 Se torneira for com pedal, tire close! É um diferencial positivo.",
                        critical: false
                    }
                ]
            },
            {
                id: 5,
                title: "♻️ COLETORES DE RESÍDUOS",
                count: 5,
                type: "critical",
                items: [
                    {
                        id: 11,
                        title: "FOTO 11 - Coletor Infectante (Grupo A) - Geral ⭐",
                        desc: "Saco BRANCO, símbolo ☣️ visível, tampa com pedal, nível até 2/3",
                        tips: "💡 1-2m de distância. Mostre lixeira completa (base até tampa).",
                        analysis: "Verificar: Símbolo é IMPRESSO? Tampa tem pedal? Nível adequado?",
                        critical: true
                    },
                    {
                        id: 12,
                        title: "FOTO 12 - Infectante - Close no Símbolo ⭐",
                        desc: "Símbolo ☣️ bem nítido. VERIFICAR: impresso ou adesivo?",
                        tips: "💡 30-50cm de distância. Foto deve ficar legível!",
                        alert: "⚠️ Se símbolo for ADESIVO = NÃO CONFORMIDADE!",
                        critical: true
                    },
                    {
                        id: 13,
                        title: "FOTO 13 - Coletor Comum (Grupo D) ⭐",
                        desc: "Saco PRETO/CINZA, SEM símbolo, SEPARADO do infectante",
                        tips: "💡 Mostre que as duas lixeiras estão claramente separadas.",
                        alert: "⚠️ GRAVE: Resíduos infectantes no comum = MISTURA PROIBIDA!",
                        critical: true
                    },
                    {
                        id: 14,
                        title: "FOTO 14 - Perfurocortante FECHADO ⭐⭐⭐",
                        desc: "Cor AMARELA, material rígido, TAMPA VEDADA, até 2/3",
                        tips: "💡 0,5-1m. Verifique visualmente se tampa está bem vedada!",
                        alert: "🚨 NUNCA fotografe ABERTO! Risco de acidente!",
                        analysis: "Tampa fechada? Cor amarela? Nível adequado? Sem avarias?",
                        critical: true
                    },
                    {
                        id: 15,
                        title: "FOTO 15 - Perfurocortante - Etiqueta ⭐⭐⭐",
                        desc: "☣️, 'PERFUROCORTANTE', 'SALA 1701', capacidade, nível máximo",
                        tips: "💡 20-30cm bem de perto. Deve ficar 100% legível!",
                        alert: "⚠️ Se faltar informação na etiqueta = não conformidade!",
                        critical: true
                    }
                ]
            },
            {
                id: 6,
                title: "🧼 EXPURGO",
                count: 3,
                type: "important",
                items: [
                    {
                        id: 16,
                        title: "FOTO 16 - Porta do Expurgo",
                        desc: "Identificação 'EXPURGO' ou 'SALA DE UTILIDADES' visível",
                        tips: "💡 Porta externa com identificação legível.",
                        critical: false
                    },
                    {
                        id: 17,
                        title: "FOTO 17 - Expurgo (visão geral interna)",
                        desc: "Pia, prateleiras, produtos de limpeza, organização",
                        tips: "💡 Vista ampla. Ambiente deve estar arrumado.",
                        critical: false
                    },
                    {
                        id: 18,
                        title: "FOTO 18 - Pia do Expurgo (detalhe) ⭐",
                        desc: "Close pia e torneira. Verificar: pedal/alavanca/manual?",
                        tips: "💡 Torneira com pedal = ÓTIMO! Mencione no relatório.",
                        critical: true
                    }
                ]
            },
            {
                id: 7,
                title: "🚽 BANHEIROS",
                count: 1,
                type: "normal",
                items: [
                    {
                        id: 19,
                        title: "FOTO 19 - Banheiro (visão geral)",
                        desc: "Vaso, pia, revestimento cerâmico, limpeza e conservação",
                        tips: "💡 Fotografe com banheiro limpo e arrumado.",
                        critical: false
                    }
                ]
            },
            {
                id: 8,
                title: "📦 ARMAZ. TEMPORÁRIO - 17º",
                count: 3,
                type: "critical",
                items: [
                    {
                        id: 20,
                        title: "FOTO 20 - Porta/Área do Armazenamento",
                        desc: "Local no 17º andar, identificação, localização",
                        tips: "💡 Pode ser sala, quartinho ou área no corredor do andar.",
                        critical: false
                    },
                    {
                        id: 21,
                        title: "FOTO 21 - BOMBONA AZUL 50L ⭐⭐⭐",
                        desc: "Cor AZUL, TAMPA HERMÉTICA!, etiqueta 'SALA 1701', ☣️",
                        tips: "💡 0,5-1m. Foto deve mostrar CLARAMENTE que tampa está vedada!",
                        alert: "🚨 GRAVÍSSIMO: Bombona ABERTA/MAL VEDADA = risco de contaminação!",
                        analysis: "Pergunte ao responsável: 'A bombona está bem fechada?'",
                        critical: true
                    },
                    {
                        id: 22,
                        title: "FOTO 22 - Lixeira Comum (se houver)",
                        desc: "Saco preto (Grupo D), separada do infectante",
                        tips: "💡 Mostrar segregação também no armazenamento temporário.",
                        critical: false
                    }
                ]
            },
            {
                id: 9,
                title: "🏢 ABRIGO EXTERNO - TÉRREO",
                count: 7,
                type: "critical",
                items: [
                    {
                        id: 23,
                        title: "FOTO 23 - Portão Rua Miosótis",
                        desc: "Vista externa, portão onde caminhão para, acesso facilitado",
                        tips: "💡 Tire da calçada mostrando portão e acesso.",
                        critical: false
                    },
                    {
                        id: 24,
                        title: "FOTO 24 - Porta Interna do Abrigo ⭐",
                        desc: "Vista de dentro do edifício, identificação 'RESÍDUOS', ☣️",
                        tips: "💡 Entrada mostrando identificação clara.",
                        critical: true
                    },
                    {
                        id: 25,
                        title: "FOTO 25 - Interior do Abrigo (geral) ⭐⭐⭐",
                        desc: "SEPARAÇÃO RSS/comum!, piso impermeável, paredes, limpeza",
                        tips: "💡 Tire de cima para baixo. Acenda TODAS as luzes!",
                        analysis: "Separação clara? Piso lavável? Presença de vetores? Recipientes fechados?",
                        critical: true
                    },
                    {
                        id: 26,
                        title: "FOTO 26 - Piso e Drenagem ⭐",
                        desc: "Piso impermeável (cerâmica/cimento), ralo sifonado, escoamento",
                        tips: "💡 Foto do chão mostrando tipo de piso e drenagem.",
                        critical: true
                    },
                    {
                        id: 27,
                        title: "FOTO 27 - Ventilação e TELA ⭐⭐",
                        desc: "Abertura ventilação, TELA proteção insetos/roedores ÍNTEGRA",
                        tips: "💡 Close na abertura. Verifique se há rasgos na tela!",
                        alert: "🚨 GRAVE: Falta de tela ou tela rasgada = entrada de vetores!",
                        critical: true
                    },
                    {
                        id: 28,
                        title: "FOTO 28 - Porta Específica para RSS ⭐",
                        desc: "Área/porta com ☣️, identificação 'GRUPO A' ou 'RSS', separada",
                        tips: "💡 Mostrar segregação no abrigo externo.",
                        critical: true
                    },
                    {
                        id: 29,
                        title: "FOTO 29 - Ponto de Água",
                        desc: "Torneira/mangueira para higienização, lavagem de coletores",
                        tips: "💡 Mostrar que é possível higienizar recipientes no local.",
                        critical: false
                    }
                ]
            },
            {
                id: 10,
                title: "📄 DOCUMENTAÇÃO TÉCNICA",
                count: 4,
                type: "important",
                items: [
                    {
                        id: 30,
                        title: "FOTO 30 - Certificado Reservatório ⭐",
                        desc: "SANITIZAR, higienização Abr/2025, validade 01/10/2025",
                        tips: "💡 Documento completo e legível. Verifique validade!",
                        analysis: "Dentro da validade na data da visita?",
                        critical: true
                    },
                    {
                        id: 31,
                        title: "FOTO 31 - Certificado Dedetização ⭐",
                        desc: "T C Costa, data Abr/2025, validade 08/10/2025",
                        tips: "💡 Foto legível de todo o certificado. Verifique validade!",
                        analysis: "Dentro da validade na data da visita?",
                        critical: true
                    },
                    {
                        id: 32,
                        title: "FOTO 32 - Contrato NATUS Ambiental",
                        desc: "1ª página, coleta mensal de RSS (Grupos A e E)",
                        tips: "💡 Não precisa contrato inteiro, só 1ª página identificando serviço.",
                        critical: false
                    },
                    {
                        id: 33,
                        title: "FOTO 33 - Licença da NATUS (se disponível)",
                        desc: "Licença ambiental da empresa coletora, CNPJ, validade",
                        tips: "💡 Se não tiverem, anote no relatório 'não disponibilizado'.",
                        critical: false
                    }
                ]
            }
        ];

        // STATE
        let appState = {
            itemsChecked: {},
            itemsPhotos: {},
            itemsNotes: {},
            startTime: null
        };

        // INIT
        function startApp() {
            document.getElementById('landing').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('bottomNav').style.display = 'flex';
            document.getElementById('fabContainer').style.display = 'flex';
            
            appState.startTime = new Date();
            loadState();
            renderSections();
            updateStats();
        }

        // RENDER SECTIONS
        function renderSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';
            
            sections.forEach(section => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'section';
                sectionEl.innerHTML = `
                    <div class="section-header ${section.type}" onclick="toggleSection(${section.id})">
                        <div class="section-title">
                            <span>${section.title}</span>
                            <span class="badge">${section.count}</span>
                        </div>
                        <span class="arrow" id="arrow-${section.id}">▼</span>
                    </div>
                    <div class="section-content" id="section-${section.id}">
                        ${section.items.map(item => renderItem(item)).join('')}
                    </div>
                `;
                container.appendChild(sectionEl);
            });
        }

        function renderItem(item) {
            const isChecked = appState.itemsChecked[item.id] || false;
            const photos = appState.itemsPhotos[item.id] || [];
            const notes = appState.itemsNotes[item.id] || '';
            
            return `
                <div class="item ${isChecked ? 'checked' : ''}" id="item-${item.id}">
                    <div class="item-header" onclick="toggleCheck(${item.id})">
                        <div class="checkbox-custom ${isChecked ? 'checked' : ''}" id="check-${item.id}"></div>
                        <div class="item-info">
                            <div class="item-title">
                                ${item.title}
                                ${item.critical ? '<span class="star">⭐</span>' : ''}
                            </div>
                            <div class="item-desc">${item.desc}</div>
                        </div>
                        <button class="expand-btn" onclick="event.stopPropagation(); toggleDetails(${item.id})">+</button>
                    </div>
                    <div class="item-details" id="details-${item.id}">
                        <div class="item-details-content">
                            ${item.alert ? `<div class="alert-box ${item.alert.includes('GRAVE') ? 'alert-danger' : 'alert-warning'}">${item.alert}</div>` : ''}
                            
                            <div class="detail-section">
                                <div class="detail-title">💡 Dicas Técnicas</div>
                                <div class="detail-text">${item.tips}</div>
                            </div>
                            
                            ${item.analysis ? `
                            <div class="detail-section">
                                <div class="detail-title">🔍 Análise Crítica</div>
                                <div class="detail-text">${item.analysis}</div>
                            </div>
                            ` : ''}
                            
                            <div class="detail-section photo-section">
                                <div class="detail-title">📸 Fotos (${photos.length})</div>
                                <div class="photo-upload-area" onclick="openCamera(${item.id})" 
                                     ondrop="dropPhoto(event, ${item.id})" 
                                     ondragover="event.preventDefault(); event.currentTarget.classList.add('dragover')"
                                     ondragleave="event.currentTarget.classList.remove('dragover')">
                                    <div class="upload-icon">📷</div>
                                    <div class="upload-text">Clique para adicionar foto</div>
                                    <div class="upload-hint">ou arraste e solte aqui</div>
                                </div>
                                <input type="file" id="file-${item.id}" accept="image/*" capture="environment" 
                                       onchange="handlePhoto(event, ${item.id})" multiple>
                                <div class="photo-preview-grid" id="preview-${item.id}">
                                    ${photos.map((photo, idx) => `
                                        <div class="photo-preview">
                                            <img src="${photo}" alt="Foto ${idx+1}">
                                            <button class="photo-remove" onclick="removePhoto(${item.id}, ${idx})">×</button>
                                        </div>
                                    `).join('')}
                                </div>
                                ${photos.length > 0 ? `<div class="photo-count">✓ ${photos.length} foto(s) adicionada(s)</div>` : ''}
                            </div>
                            
                            <div class="detail-section">
                                <div class="detail-title">📝 Anotações</div>
                                <textarea class="notes-textarea" 
                                          placeholder="Escreva suas observações aqui..."
                                          onchange="saveNote(${item.id}, this.value)">${notes}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // TOGGLE FUNCTIONS
        function toggleSection(sectionId) {
            const content = document.getElementById(`section-${sectionId}`);
            const arrow = document.getElementById(`arrow-${sectionId}`);
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                arrow.classList.remove('open');
            } else {
                content.classList.add('show');
                arrow.classList.add('open');
            }
        }

        function toggleCheck(itemId) {
            appState.itemsChecked[itemId] = !appState.itemsChecked[itemId];
            
            const item = document.getElementById(`item-${itemId}`);
            const checkbox = document.getElementById(`check-${itemId}`);
            
            if (appState.itemsChecked[itemId]) {
                item.classList.add('checked');
                checkbox.classList.add('checked');
            } else {
                item.classList.remove('checked');
                checkbox.classList.remove('checked');
            }
            
            updateStats();
            saveState();
        }

        function toggleDetails(itemId) {
            const details = document.getElementById(`details-${itemId}`);
            details.classList.toggle('show');
        }

        // PHOTO FUNCTIONS
        function openCamera(itemId) {
            document.getElementById(`file-${itemId}`).click();
        }

        function handlePhoto(event, itemId) {
            const files = event.target.files;
            if (!files.length) return;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (!appState.itemsPhotos[itemId]) {
                        appState.itemsPhotos[itemId] = [];
                    }
                    appState.itemsPhotos[itemId].push(e.target.result);
                    saveState();
                    updatePhotoPreview(itemId);
                };
                reader.readAsDataURL(file);
            });
        }

        function dropPhoto(event, itemId) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (!files.length) return;
            
            Array.from(files).forEach(file => {
                if (!file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (!appState.itemsPhotos[itemId]) {
                        appState.itemsPhotos[itemId] = [];
                    }
                    appState.itemsPhotos[itemId].push(e.target.result);
                    saveState();
                    updatePhotoPreview(itemId);
                };
                reader.readAsDataURL(file);
            });
        }

        function removePhoto(itemId, photoIndex) {
            if (confirm('Remover esta foto?')) {
                appState.itemsPhotos[itemId].splice(photoIndex, 1);
                saveState();
                updatePhotoPreview(itemId);
            }
        }

        function updatePhotoPreview(itemId) {
            const photos = appState.itemsPhotos[itemId] || [];
            const preview = document.getElementById(`preview-${itemId}`);
            
            preview.innerHTML = photos.map((photo, idx) => `
                <div class="photo-preview">
                    <img src="${photo}" alt="Foto ${idx+1}">
                    <button class="photo-remove" onclick="removePhoto(${itemId}, ${idx})">×</button>
                </div>
            `).join('');
            
            // Update count
            const detail = preview.closest('.photo-section');
            const existingCount = detail.querySelector('.photo-count');
            if (existingCount) existingCount.remove();
            
            if (photos.length > 0) {
                const countDiv = document.createElement('div');
                countDiv.className = 'photo-count';
                countDiv.textContent = `✓ ${photos.length} foto(s) adicionada(s)`;
                preview.after(countDiv);
            }
        }

        // NOTES
        function saveNote(itemId, note) {
            appState.itemsNotes[itemId] = note;
            saveState();
        }

        // STATS
        function updateStats() {
            const total = 33;
            const checked = Object.values(appState.itemsChecked).filter(v => v).length;
            const percentage = Math.round((checked / total) * 100);
            
            document.getElementById('statDone').textContent = checked;
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressBar').textContent = percentage + '%';
            
            // Critical items
            let criticalChecked = 0;
            sections.forEach(section => {
                section.items.forEach(item => {
                    if (item.critical && appState.itemsChecked[item.id]) {
                        criticalChecked++;
                    }
                });
            });
            
            document.getElementById('statCritical').textContent = `${criticalChecked}/13`;
        }

        // EXPAND/COLLAPSE
        function expandAll() {
            sections.forEach(section => {
                const content = document.getElementById(`section-${section.id}`);
                const arrow = document.getElementById(`arrow-${section.id}`);
                content.classList.add('show');
                arrow.classList.add('open');
            });
        }

        function collapseAll() {
            sections.forEach(section => {
                const content = document.getElementById(`section-${section.id}`);
                const arrow = document.getElementById(`arrow-${section.id}`);
                content.classList.remove('show');
                arrow.classList.remove('open');
            });
        }

        // SCROLL
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // SUMMARY
        function openSummary() {
            const checked = Object.values(appState.itemsChecked).filter(v => v).length;
            const total = 33;
            const percentage = Math.round((checked / total) * 100);
            
            let criticalChecked = 0;
            let totalPhotos = 0;
            let notesCount = 0;
            
            sections.forEach(section => {
                section.items.forEach(item => {
                    if (item.critical && appState.itemsChecked[item.id]) criticalChecked++;
                    if (appState.itemsPhotos[item.id]) totalPhotos += appState.itemsPhotos[item.id].length;
                    if (appState.itemsNotes[item.id]) notesCount++;
                });
            });
            
            const duration = appState.startTime ? 
                Math.round((new Date() - appState.startTime) / 60000) : 0;
            
            document.getElementById('summaryContent').innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 48px; font-weight: 700; color: var(--primary);">${percentage}%</div>
                    <div style="font-size: 14px; color: #64748b;">Progresso Total</div>
                </div>
                
                <div style="background: var(--light); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>✓ Itens concluídos:</span>
                        <strong>${checked} / ${total}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>⭐ Itens críticos:</span>
                        <strong>${criticalChecked} / 13</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>📸 Total de fotos:</span>
                        <strong>${totalPhotos}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>📝 Anotações feitas:</span>
                        <strong>${notesCount}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>⏱️ Tempo decorrido:</span>
                        <strong>${duration} min</strong>
                    </div>
                </div>
                
                <div style="background: #fef3c7; padding: 12px; border-radius: 10px; font-size: 12px;">
                    <strong>💡 Dica:</strong> Revise os itens críticos ⭐ antes de finalizar!
                </div>
            `;
            
            document.getElementById('summaryModal').classList.add('active');
        }

        function closeSummary() {
            document.getElementById('summaryModal').classList.remove('active');
        }

        function generateReport() {
            alert('Funcionalidade de geração de relatório será implementada em breve!');
        }

        // EXPORT
        function openExportModal() {
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function downloadJSON() {
            const data = {
                ...appState,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio-rss-${Date.now()}.json`;
            a.click();
            
            closeExportModal();
        }

        function shareProgress() {
            const checked = Object.values(appState.itemsChecked).filter(v => v).length;
            const percentage = Math.round((checked / 33) * 100);
            
            const text = `📸 Relatório Fotográfico RSS\n\n✓ Progresso: ${percentage}%\n✓ ${checked}/33 itens concluídos\n\n#RSS #Inspeção #ClínicaEulálio`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Relatório Fotográfico RSS',
                    text: text
                });
            } else {
                navigator.clipboard.writeText(text);
                alert('Texto copiado para área de transferência!');
            }
            
            closeExportModal();
        }

        // STORAGE
        function saveState() {
            localStorage.setItem('appState', JSON.stringify(appState));
        }

        function loadState() {
            const saved = localStorage.getItem('appState');
            if (saved) {
                appState = JSON.parse(saved);
            }
        }

        // INIT ON LOAD
        if (localStorage.getItem('appState')) {
            // Se já tem dados salvos, pular landing
            startApp();
        }
    </script>
</body>
</html>